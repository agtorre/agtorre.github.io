<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>versioning on Aaron's Desk Chair Adventures</title><link>https://www.aaron-torres.com/tags/versioning/</link><description>Recent content in versioning on Aaron's Desk Chair Adventures</description><generator>Hugo -- gohugo.io</generator><managingEditor>me@aaron-torres.com (Aaron Torres)</managingEditor><webMaster>me@aaron-torres.com (Aaron Torres)</webMaster><copyright>Copyright &amp;copy; 2020 - Aaron Torres</copyright><lastBuildDate>Tue, 17 May 2016 00:00:00 +0000</lastBuildDate><atom:link href="https://www.aaron-torres.com/tags/versioning/index.xml" rel="self" type="application/rss+xml"/><item><title>Go API Versioning with Gorilla Mux</title><link>https://www.aaron-torres.com/post/api-versioning-gorilla-mux/</link><pubDate>Tue, 17 May 2016 00:00:00 +0000</pubDate><author>me@aaron-torres.com (Aaron Torres)</author><guid>https://www.aaron-torres.com/post/api-versioning-gorilla-mux/</guid><description>&lt;h3 id="code-based-versioning">Code-Based Versioning&lt;/h3>
&lt;p>Recently I had a problem where I needed to implement API versioning in code. The versions would share the vast majority of routes/handlers and I found that I wanted to re-use the base routes and modifying them slightly between versions. I imagined using &lt;a href="http://www.gorillatoolkit.org/pkg/mux">Gorilla mux router&lt;/a> as the base with all the routes and then creating a new router for v1, v2, etc that would &amp;lsquo;inherit&amp;rsquo; the base routes and only modify a few. That would maximize code-reuse as I&amp;rsquo;d only have to modify the latest route in one place for many versions to receive the benefit.&lt;/p>
&lt;p>I searched around Google, Stack Overflow, and the Gorilla mux documentation about attaching a subrouter to a route and similar terms, but I struggled to find a working solution. I found a few useful posts and here&amp;rsquo;s the result:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> (
&lt;span style="color:#e6db74">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;span style="color:#e6db74">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;span style="color:#e6db74">&amp;#34;github.com/gorilla/mux&amp;#34;&lt;/span>
)
&lt;span style="color:#75715e">// AnotherHandlerLatest is the newest version of AnotherHandler
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">AnotherHandlerLatest&lt;/span>(&lt;span style="color:#a6e22e">w&lt;/span> &lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">ResponseWriter&lt;/span>, &lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">Request&lt;/span>) {
&lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Fprintf&lt;/span>(&lt;span style="color:#a6e22e">w&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;hello from AnotherHandlerLatest.&amp;#34;&lt;/span>)
}
&lt;span style="color:#75715e">// ExampleHandlerLatest is the newest version of ExampleHandler
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">ExampleHandlerLatest&lt;/span>(&lt;span style="color:#a6e22e">w&lt;/span> &lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">ResponseWriter&lt;/span>, &lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">Request&lt;/span>) {
&lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Fprintf&lt;/span>(&lt;span style="color:#a6e22e">w&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;hello from ExampleHandlerLatest.&amp;#34;&lt;/span>)
}
&lt;span style="color:#75715e">// ExampleHandlerV1 is a v1-compatible version of ExampleHandler
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">ExampleHandlerV1&lt;/span>(&lt;span style="color:#a6e22e">w&lt;/span> &lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">ResponseWriter&lt;/span>, &lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">Request&lt;/span>) {
&lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Fprintf&lt;/span>(&lt;span style="color:#a6e22e">w&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Hello from ExampleHandlerv1.&amp;#34;&lt;/span>)
}
&lt;span style="color:#75715e">// AddV1Routes takes a router or subrouter and adds all the v1
&lt;/span>&lt;span style="color:#75715e">// routes to it
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">AddV1Routes&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">mux&lt;/span>.&lt;span style="color:#a6e22e">Router&lt;/span>) {
&lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">HandleFunc&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/example&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">ExampleHandlerV1&lt;/span>)
&lt;span style="color:#a6e22e">AddRoutes&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span>)
}
&lt;span style="color:#75715e">// AddV2Routes takes a router or subrouter and adds all the v2
&lt;/span>&lt;span style="color:#75715e">// routes to it, note that these should probably match
&lt;/span>&lt;span style="color:#75715e">// AddRoutes(r *muxRouter) alternatively you can do
&lt;/span>&lt;span style="color:#75715e">// var AddV2Routes = AddRoutes
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">AddV2Routes&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">mux&lt;/span>.&lt;span style="color:#a6e22e">Router&lt;/span>) {
&lt;span style="color:#a6e22e">AddRoutes&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span>)
}
&lt;span style="color:#75715e">// AddRoutes takes a router or subrouter and adds all the latest
&lt;/span>&lt;span style="color:#75715e">// routes to it
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">AddRoutes&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">mux&lt;/span>.&lt;span style="color:#a6e22e">Router&lt;/span>) {
&lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">HandleFunc&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/example&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">ExampleHandlerLatest&lt;/span>)
&lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">HandleFunc&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/example2&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">AnotherHandlerLatest&lt;/span>)
}
&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;span style="color:#a6e22e">router&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">mux&lt;/span>.&lt;span style="color:#a6e22e">NewRouter&lt;/span>()
&lt;span style="color:#75715e">// latest
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">AddRoutes&lt;/span>(&lt;span style="color:#a6e22e">router&lt;/span>)
&lt;span style="color:#75715e">// v1
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">AddV1Routes&lt;/span>(&lt;span style="color:#a6e22e">router&lt;/span>.&lt;span style="color:#a6e22e">PathPrefix&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/v1&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">Subrouter&lt;/span>())
&lt;span style="color:#75715e">// v2
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">AddV2Routes&lt;/span>(&lt;span style="color:#a6e22e">router&lt;/span>.&lt;span style="color:#a6e22e">PathPrefix&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/v2&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">Subrouter&lt;/span>())
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>The end result of this is that /example and /v2/example point at the same handler, but /v1/example points at a different handler. When a new version is created, I rename HandlerLatest to HandlerVn where n is the previous newest version. I add it to the AddVnRoutes, create an AddVn+1Routes and new version is made! I can easily deprecate older versions (and their associated handlers) as needed.&lt;/p></description></item><item><title>Go Validation Tricks</title><link>https://www.aaron-torres.com/post/validation-tricks/</link><pubDate>Thu, 25 Jun 2015 00:00:00 +0000</pubDate><author>me@aaron-torres.com (Aaron Torres)</author><guid>https://www.aaron-torres.com/post/validation-tricks/</guid><description>&lt;p>As I&amp;rsquo;ve gotten more familiar with Go web programming, I&amp;rsquo;ve tried to solve the problem of form and payload validation a number of different ways. Coming from a Python background, I initially really liked the idea of using a validation method.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Form&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span>{
&lt;span style="color:#a6e22e">Field1&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span> &lt;span style="color:#e6db74">`json:&amp;#34;field1&amp;#34;`&lt;/span>
&lt;span style="color:#a6e22e">Field2&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#e6db74">`json:&amp;#34;field2&amp;#34;`&lt;/span>
}
&lt;span style="color:#75715e">// we can pass in multiple arguments like db, or whatever else.
&lt;/span>&lt;span style="color:#75715e">// do any validation necessary using the values in Form
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#a6e22e">f&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Form&lt;/span>) &lt;span style="color:#a6e22e">Validate&lt;/span>(&lt;span style="color:#a6e22e">db&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Database&lt;/span>) &lt;span style="color:#66d9ef">error&lt;/span>{
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>There are a few problems with this approach. The first problem is that this validate method is likely to return an error immediately rather than aggregate them all. The second problem is that this validation method is incredibly painful to mock when testing.&lt;/p>
&lt;h3 id="first-problem">First Problem&lt;/h3>
&lt;p>Let&amp;rsquo;s take a stab at the first problem. In Go, errors are actually an &lt;a href="http://blog.golang.org/error-handling-and-go">interface&lt;/a>. One way to implement an error interface and return all errors at the same time might be this Verror approach that &lt;a href="http://husobee.github.io">husobee&lt;/a> and I came up with:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#f92672">import&lt;/span> (
&lt;span style="color:#e6db74">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;span style="color:#e6db74">&amp;#34;strings&amp;#34;&lt;/span>
)
&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">NewVerror&lt;/span>() &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Verrors&lt;/span> {
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">Verrors&lt;/span>{
&lt;span style="color:#a6e22e">Errors&lt;/span>: make(&lt;span style="color:#66d9ef">map&lt;/span>[&lt;span style="color:#66d9ef">string&lt;/span>][]&lt;span style="color:#66d9ef">string&lt;/span>),
}
}
&lt;span style="color:#75715e">// keys represent the field
&lt;/span>&lt;span style="color:#75715e">// and each field can have numerous errors
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Verrors&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> {
&lt;span style="color:#a6e22e">Errors&lt;/span> &lt;span style="color:#66d9ef">map&lt;/span>[&lt;span style="color:#66d9ef">string&lt;/span>][]&lt;span style="color:#66d9ef">string&lt;/span>
}
&lt;span style="color:#75715e">// also works with duplicate errors!
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#a6e22e">e&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Verrors&lt;/span>) &lt;span style="color:#a6e22e">AddError&lt;/span>(&lt;span style="color:#a6e22e">field&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span>) {
&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">ok&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">e&lt;/span>.&lt;span style="color:#a6e22e">Errors&lt;/span>[&lt;span style="color:#a6e22e">field&lt;/span>]; !&lt;span style="color:#a6e22e">ok&lt;/span> {
&lt;span style="color:#a6e22e">e&lt;/span>.&lt;span style="color:#a6e22e">Errors&lt;/span>[&lt;span style="color:#a6e22e">field&lt;/span>] = make([]&lt;span style="color:#66d9ef">string&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>)
}
&lt;span style="color:#66d9ef">for&lt;/span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">ele&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#66d9ef">range&lt;/span> &lt;span style="color:#a6e22e">e&lt;/span>.&lt;span style="color:#a6e22e">Errors&lt;/span>[&lt;span style="color:#a6e22e">field&lt;/span>] {
&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">ele&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> {
&lt;span style="color:#66d9ef">return&lt;/span>
}
}
&lt;span style="color:#a6e22e">e&lt;/span>.&lt;span style="color:#a6e22e">Errors&lt;/span>[&lt;span style="color:#a6e22e">field&lt;/span>] = append(&lt;span style="color:#a6e22e">e&lt;/span>.&lt;span style="color:#a6e22e">Errors&lt;/span>[&lt;span style="color:#a6e22e">field&lt;/span>], &lt;span style="color:#a6e22e">err&lt;/span>)
}
&lt;span style="color:#75715e">// we can aggregate together functions that return verrors
&lt;/span>&lt;span style="color:#75715e">// or multiple verrors from go routines, for example
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#a6e22e">e&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Verrors&lt;/span>) &lt;span style="color:#a6e22e">Merge&lt;/span>(&lt;span style="color:#a6e22e">e2&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Verrors&lt;/span>) {
&lt;span style="color:#66d9ef">for&lt;/span> &lt;span style="color:#a6e22e">key&lt;/span>, &lt;span style="color:#a6e22e">values&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#66d9ef">range&lt;/span> &lt;span style="color:#a6e22e">e2&lt;/span>.&lt;span style="color:#a6e22e">Errors&lt;/span> {
&lt;span style="color:#66d9ef">for&lt;/span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">value&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#66d9ef">range&lt;/span> &lt;span style="color:#a6e22e">values&lt;/span> {
&lt;span style="color:#a6e22e">e&lt;/span>.&lt;span style="color:#a6e22e">AddError&lt;/span>(&lt;span style="color:#a6e22e">key&lt;/span>, &lt;span style="color:#a6e22e">value&lt;/span>)
}
}
}
&lt;span style="color:#75715e">// if you want to return nil instead of an empty verror
&lt;/span>&lt;span style="color:#75715e">// check if Valid return false first
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#a6e22e">e&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Verrors&lt;/span>) &lt;span style="color:#a6e22e">Valid&lt;/span>() &lt;span style="color:#66d9ef">bool&lt;/span>{
&lt;span style="color:#66d9ef">return&lt;/span> len(&lt;span style="color:#a6e22e">e&lt;/span>.&lt;span style="color:#a6e22e">Errors&lt;/span>) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
}
&lt;span style="color:#75715e">// satisfies the error interface
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#a6e22e">e&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Verrors&lt;/span>) &lt;span style="color:#a6e22e">Error&lt;/span>() &lt;span style="color:#66d9ef">string&lt;/span> {
&lt;span style="color:#a6e22e">response&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">for&lt;/span> &lt;span style="color:#a6e22e">k&lt;/span>, &lt;span style="color:#a6e22e">v&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#66d9ef">range&lt;/span> &lt;span style="color:#a6e22e">e&lt;/span>.&lt;span style="color:#a6e22e">Errors&lt;/span> {
&lt;span style="color:#a6e22e">response&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;%s: [%s]&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">k&lt;/span>, &lt;span style="color:#a6e22e">strings&lt;/span>.&lt;span style="color:#a6e22e">Join&lt;/span>(&lt;span style="color:#a6e22e">v&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;,&amp;#34;&lt;/span>))
}
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">response&lt;/span>
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Verrors are pretty flexible, you can even return them as JSON with some additional type checking. Keep in mind this doesn&amp;rsquo;t work too well if you&amp;rsquo;re returning XML.&lt;/p>
&lt;h3 id="second-problem">Second Problem&lt;/h3>
&lt;p>Mocking in tests is a very large topic, and could be a blog post all on its own. In Go, the only way to mock a method is with an interface. There&amp;rsquo;s a more comprehensive example &lt;a href="http://play.golang.org/p/cWLT0aSkF2">here&lt;/a>, but the gist of it is:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Form&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span>{
&lt;span style="color:#a6e22e">Field1&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span> &lt;span style="color:#e6db74">`json:&amp;#34;field1&amp;#34;`&lt;/span>
&lt;span style="color:#a6e22e">Field2&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#e6db74">`json:&amp;#34;field2&amp;#34;`&lt;/span>
}
&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#a6e22e">f&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Form&lt;/span>) &lt;span style="color:#a6e22e">Validate&lt;/span>(&lt;span style="color:#a6e22e">db&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Database&lt;/span>) &lt;span style="color:#66d9ef">error&lt;/span>{
}
&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">FormValidater&lt;/span> &lt;span style="color:#66d9ef">interface&lt;/span>{
&lt;span style="color:#a6e22e">Validate&lt;/span>(&lt;span style="color:#a6e22e">db&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Database&lt;/span>) &lt;span style="color:#66d9ef">error&lt;/span>
}
&lt;span style="color:#75715e">// we can pass in a mock here
&lt;/span>&lt;span style="color:#75715e">// rarely this simple unfortunately
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">ShowMock&lt;/span>(&lt;span style="color:#a6e22e">f&lt;/span> &lt;span style="color:#a6e22e">FormValidater&lt;/span>){
&lt;span style="color:#a6e22e">db&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">getDatabase&lt;/span>()
&lt;span style="color:#a6e22e">f&lt;/span>.&lt;span style="color:#a6e22e">Validate&lt;/span>(&lt;span style="color:#a6e22e">db&lt;/span>)
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>If you&amp;rsquo;re unable to wrap your methods in an interface, for example when the method and its struct are both in the same scope, mocking these methods is pretty much impossible.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">Handler&lt;/span>(&lt;span style="color:#a6e22e">w&lt;/span> &lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">ResponseWriter&lt;/span>, &lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">Request&lt;/span>){
&lt;span style="color:#a6e22e">db&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">getDatabase&lt;/span>()
&lt;span style="color:#a6e22e">c&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">getFromJSON&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span>)
&lt;span style="color:#a6e22e">c&lt;/span>.&lt;span style="color:#a6e22e">Validate&lt;/span>(&lt;span style="color:#a6e22e">db&lt;/span>)
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Another option is using a function that takes the form object as the first argument instead of a method. With functions you can use: &lt;a href="http://play.golang.org/p/oLF1XnRX3C">patch/restore&lt;/a>.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Form&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span>{
&lt;span style="color:#a6e22e">Field1&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span> &lt;span style="color:#e6db74">`json:&amp;#34;field1&amp;#34;`&lt;/span>
&lt;span style="color:#a6e22e">Field2&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#e6db74">`json:&amp;#34;field2&amp;#34;`&lt;/span>
}
&lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">ValidateForm&lt;/span> = &lt;span style="color:#66d9ef">func&lt;/span>(&lt;span style="color:#a6e22e">f&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Form&lt;/span>, &lt;span style="color:#a6e22e">db&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Database&lt;/span>) &lt;span style="color:#66d9ef">error&lt;/span>{
}
&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">ShowMock&lt;/span>(){
&lt;span style="color:#66d9ef">defer&lt;/span> &lt;span style="color:#a6e22e">Patch&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">ValidateForm&lt;/span>, &lt;span style="color:#66d9ef">func&lt;/span>(&lt;span style="color:#a6e22e">f&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Form&lt;/span>, &lt;span style="color:#a6e22e">db&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Database&lt;/span>) &lt;span style="color:#66d9ef">error&lt;/span>{
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span>
}).&lt;span style="color:#a6e22e">Restore&lt;/span>()
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>This has the unfortunate side-effect of modifying the global ValidateForm definition and is not thread-safe. For tests this is typically not an issue, but if you want to avoid patch/restore, another strategy is to make use of struct closure variables:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Form&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> {
&lt;span style="color:#a6e22e">Field1&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span> &lt;span style="color:#e6db74">`json:&amp;#34;field1&amp;#34;`&lt;/span>
&lt;span style="color:#a6e22e">Field2&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#e6db74">`json:&amp;#34;field2&amp;#34;`&lt;/span>
}
&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">ValidateForm&lt;/span>(&lt;span style="color:#a6e22e">f&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Form&lt;/span>, &lt;span style="color:#a6e22e">db&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Database&lt;/span>) &lt;span style="color:#66d9ef">error&lt;/span> {
}
&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">NewFormProcessor&lt;/span>() &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">FormProcessor&lt;/span> {
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">FormProcessor&lt;/span>{
&lt;span style="color:#a6e22e">ValidateForm&lt;/span>: &lt;span style="color:#a6e22e">ValidateForm&lt;/span>,
}
}
&lt;span style="color:#75715e">// ValidateForm is a closure
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">FormProcessor&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> {
&lt;span style="color:#a6e22e">ValidateForm&lt;/span> &lt;span style="color:#66d9ef">func&lt;/span>(&lt;span style="color:#a6e22e">f&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Form&lt;/span>, &lt;span style="color:#a6e22e">db&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Database&lt;/span>) &lt;span style="color:#66d9ef">error&lt;/span>
}
&lt;span style="color:#75715e">// an example of mocking ValidateForm that is
&lt;/span>&lt;span style="color:#75715e">// thread-safe
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#a6e22e">f&lt;/span> &lt;span style="color:#a6e22e">FormProcessor&lt;/span>) &lt;span style="color:#a6e22e">ShowMock&lt;/span>() {
&lt;span style="color:#a6e22e">f&lt;/span>.&lt;span style="color:#a6e22e">ValidateForm&lt;/span> = &lt;span style="color:#66d9ef">func&lt;/span>(&lt;span style="color:#a6e22e">f&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Form&lt;/span>, &lt;span style="color:#a6e22e">db&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Database&lt;/span>) &lt;span style="color:#66d9ef">error&lt;/span> {
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span>
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>The controllers discussed &lt;a href="https://www.aaron-torres.com/post/handlers-and-state/">here&lt;/a> can make great use of an embedded FormProcessor (which can hold any number of validation functions). An example can be found &lt;a href="http://play.golang.org/p/dkGVfVG86u">here&lt;/a>.&lt;/p>
&lt;h3 id="conclusion">Conclusion&lt;/h3>
&lt;p>I&amp;rsquo;ve touched on a few strategies for tackling the validation problem, and I also highly encourage you to check out this &lt;a href="https://github.com/asaskevich/govalidator">validation library&lt;/a> to supplement this information. I&amp;rsquo;ll probably discuss this more in the future as I inevitably revisit this myself again.&lt;/p></description></item><item><title>Go Handlers and State</title><link>https://www.aaron-torres.com/post/handlers-and-state/</link><pubDate>Sun, 14 Jun 2015 00:00:00 +0000</pubDate><author>me@aaron-torres.com (Aaron Torres)</author><guid>https://www.aaron-torres.com/post/handlers-and-state/</guid><description>&lt;p>Today I&amp;rsquo;d like to get a bit technical about things I&amp;rsquo;ve been learning and working on in the Go language&lt;/p>
&lt;p>Sometimes it&amp;rsquo;s helpful to pass additional state into a &lt;a href="http://golang.org/pkg/net/http/#HandlerFunc">web handler function&lt;/a>. For all the examples below, lets assume you want to have a toggle for authentication that is checked once within the handler function. These functions have a specific signature and make it difficult to both add parameters and remain compatible with other libraries. There are many ways to accomplish this, including middleware with some combination of &lt;a href="https://github.com/codegangsta/negroni">middleware&lt;/a> and &lt;a href="http://www.gorillatoolkit.org/pkg/context">context&lt;/a> libraries. This has the advantage of allowing each request to modify the stored context value without interfering with other handlers. It&amp;rsquo;s a bit complicated if you happen to forget to turn on the middleware and requires a diligent programmer to not hit panics inside the handler by implementing functions like DoAuth below.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">key&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>
&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">AuthKey&lt;/span> &lt;span style="color:#a6e22e">key&lt;/span> = &lt;span style="color:#ae81ff">0&lt;/span>
&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">UseAuth&lt;/span>(&lt;span style="color:#a6e22e">w&lt;/span> &lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">ResponseWriter&lt;/span>, &lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">Request&lt;/span>, &lt;span style="color:#a6e22e">next&lt;/span> &lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">HandlerFunc&lt;/span>){
&lt;span style="color:#a6e22e">context&lt;/span>.&lt;span style="color:#a6e22e">Set&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span>, &lt;span style="color:#a6e22e">AuthKey&lt;/span>, &lt;span style="color:#66d9ef">true&lt;/span>)
&lt;span style="color:#a6e22e">next&lt;/span>(&lt;span style="color:#a6e22e">w&lt;/span>, &lt;span style="color:#a6e22e">r&lt;/span>)
&lt;span style="color:#a6e22e">context&lt;/span>.&lt;span style="color:#a6e22e">Clear&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span>)
}
&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">DoAuth&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">Request&lt;/span>)(&lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#66d9ef">error&lt;/span>){
&lt;span style="color:#75715e">// in case middle-ware isn&amp;#39;t turned on...
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">doAuth&lt;/span>, &lt;span style="color:#a6e22e">ok&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">context&lt;/span>.&lt;span style="color:#a6e22e">Get&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span>, &lt;span style="color:#a6e22e">AuthKey&lt;/span>); &lt;span style="color:#a6e22e">ok&lt;/span>{
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">doAuth&lt;/span>, &lt;span style="color:#66d9ef">nil&lt;/span>
}
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>, &lt;span style="color:#a6e22e">errors&lt;/span>.&lt;span style="color:#a6e22e">New&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;middleware off&amp;#34;&lt;/span>)
}
&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">AllTheInfo&lt;/span>(&lt;span style="color:#a6e22e">w&lt;/span> &lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">ResponseWriter&lt;/span>, &lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">Request&lt;/span>){
&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">doAuth&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">DoAuth&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span>); &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#a6e22e">doAuth&lt;/span>{
&lt;span style="color:#75715e">// do something here
&lt;/span>&lt;span style="color:#75715e">&lt;/span> }
}
&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(){
&lt;span style="color:#a6e22e">n&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">negroni&lt;/span>.&lt;span style="color:#a6e22e">New&lt;/span>()
&lt;span style="color:#a6e22e">n&lt;/span>.&lt;span style="color:#a6e22e">Use&lt;/span>(&lt;span style="color:#a6e22e">UseAuth&lt;/span>)
&lt;span style="color:#a6e22e">mux&lt;/span> = &lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">NewServeMux&lt;/span>()
&lt;span style="color:#a6e22e">mux&lt;/span>.&lt;span style="color:#a6e22e">HandleFunc&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">AllTheInfo&lt;/span>)
&lt;span style="color:#a6e22e">n&lt;/span>.&lt;span style="color:#a6e22e">UseHandler&lt;/span>(&lt;span style="color:#a6e22e">mux&lt;/span>)
&lt;span style="color:#a6e22e">n&lt;/span>.&lt;span style="color:#a6e22e">Run&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;:8000&amp;#34;&lt;/span>)
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>A simpler, but potentially less flexible approach is to use controllers. It&amp;rsquo;s important to remember and keep in mind that controller variables should not be modified inside the handler as it will modify the controller for all other handlers that make use of it. For example, it may seem tempting to set some state based on the current request, but this is not recommended out of the box. Some examples of packages that get around this limitation by creating a controller each request include &lt;a href="https://github.com/gocraft/web">gocraft/web&lt;/a> and this &lt;a href="https://github.com/codegangsta/controller">controller&lt;/a> library.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Controller&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span>{
&lt;span style="color:#a6e22e">DoAuth&lt;/span> &lt;span style="color:#66d9ef">bool&lt;/span>
}
&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#a6e22e">c&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Controller&lt;/span>) &lt;span style="color:#a6e22e">AllTheInfo&lt;/span>(&lt;span style="color:#a6e22e">w&lt;/span> &lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">ResponseWriter&lt;/span>, &lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">Request&lt;/span>){
&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">c&lt;/span>.&lt;span style="color:#a6e22e">DoAuth&lt;/span>{
&lt;span style="color:#75715e">// do something here
&lt;/span>&lt;span style="color:#75715e">&lt;/span> }
}
&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(){
&lt;span style="color:#a6e22e">c&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">Controller&lt;/span>{&lt;span style="color:#a6e22e">DoAuth&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>}
&lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">HandleFunc&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">c&lt;/span>.&lt;span style="color:#a6e22e">AllTheInfo&lt;/span>)
&lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">ListenAndServe&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;:8000&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">nil&lt;/span>)
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Finally, a very light-weight approach I like to make use of is closures. Closures allow the state to be modified from within the handler and are also granular enough that you can tweak them for every route without initializing additional controllers or wrapping every route with middleware incurring context look-up and reflection overhead.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">CheckAllTheInfo&lt;/span>(&lt;span style="color:#a6e22e">DoAuth&lt;/span> &lt;span style="color:#66d9ef">bool&lt;/span>) &lt;span style="color:#66d9ef">func&lt;/span>(&lt;span style="color:#a6e22e">w&lt;/span> &lt;span style="color:#a6e22e">ResponseWriter&lt;/span>, &lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Request&lt;/span>){
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">func&lt;/span>(&lt;span style="color:#a6e22e">w&lt;/span> &lt;span style="color:#a6e22e">ResponseWriter&lt;/span>, &lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Request&lt;/span>){
&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">DoAuth&lt;/span>{
&lt;span style="color:#75715e">// do something here
&lt;/span>&lt;span style="color:#75715e">&lt;/span> }
}
}
&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(){
&lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">HandleFunc&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">CheckAllTheInfo&lt;/span>(&lt;span style="color:#66d9ef">true&lt;/span>))
&lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">ListenAndServe&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;:8000&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">nil&lt;/span>)
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Overall, there&amp;rsquo;s a lot of ways to accomplish injecting state for web handler functions in Go. There are a number of other middleware packages besides negroni and there are even context objects build into the &lt;a href="https://godoc.org/golang.org/x/net/context">standard library&lt;/a> now. I use combinations of all of these as one doesn&amp;rsquo;t scratch all the itches I have. You can also combine these, for example you could attach a context object to a controller that is safe to modify or wrap a controller method in a closure.&lt;/p></description></item><item><title>Looking and Moving Forward</title><link>https://www.aaron-torres.com/post/moving-forward/</link><pubDate>Sun, 05 Jan 2014 00:00:00 +0000</pubDate><author>me@aaron-torres.com (Aaron Torres)</author><guid>https://www.aaron-torres.com/post/moving-forward/</guid><description>&lt;p>I wanted to start this year off with a new blog built on top of Github Pages
and Jekyll, and a look back on what went well (and didn&amp;rsquo;t) in 2013.&lt;/p>
&lt;h3 id="the-job">The Job&lt;/h3>
&lt;p>The single biggest event of this year was completely uprooting our lives, packing up, and leaving the state. We did this with a car full of a few clothes, a box of important documents, a laptop, 1 cat, 1 dog, 1 baby, and 2 adult humans. We had basically lived in New Mexico our entire lives and we left behind two houses and everyone we knew in order to pursue new opportunities in Seattle. This decision was made with less than a month of notice, but not without enormous scrutiny and worry.&lt;/p>
&lt;h3 id="fears">Fears&lt;/h3>
&lt;p>The best way I can describe this entire ordeal is terrifying. Imagine completely leaving any comfort zone that you&amp;rsquo;ve created in order to pursue something nearly completely unknown. The next way I&amp;rsquo;d describe it is liberating. There&amp;rsquo;s something incredible about being able to pickup and move anywhere. However these were the gambles:&lt;/p>
&lt;ul>
&lt;li>Leaving a job I was very good at and all the security that came with it&lt;/li>
&lt;li>Downsizing from a large house that we owned into an apartment&lt;/li>
&lt;li>Selling that house in a reasonable amount of time&lt;/li>
&lt;li>Getting rid of a lot of our stuff as quickly as possible&lt;/li>
&lt;li>Finding an apartment near my new job blindly that also accepts pets and has enough room for us&lt;/li>
&lt;li>Financing this whole ordeal&lt;/li>
&lt;/ul>
&lt;h3 id="howd-that-work-out">How&amp;rsquo;d that work out?&lt;/h3>
&lt;p>The good news is, we had to get lucky 2-3 times in order to pull it off , and we nailed all of em. We got an offer on the house the same day we listed it, and sold it shortly after. We also had a successful yard sale where we sold most of what we owned. We made the drive across the country in 3 days, and we&amp;rsquo;ve settled in here so far! Our finances have stabilized, and we&amp;rsquo;re already seeing the benefits of living in the Pacific Northwest.&lt;/p>
&lt;p>I really wanted to write a post about this during that frantic period, but that would have made it even worse at the time. There&amp;rsquo;s so much more detail about each of these individual events, but that&amp;rsquo;s best left for another time. If you&amp;rsquo;re ever interested, come have a beer or coffee with me and we can chat about it.&lt;/p>
&lt;h3 id="2014">2014&lt;/h3>
&lt;p>Without further ado, lets talk about what my plans are for this year. The theme shared by these is that I&amp;rsquo;d like to try and build a personal brand. Now that I&amp;rsquo;m less rooted, it&amp;rsquo;s important that I publicize and adapt wherever possible. Having said that here&amp;rsquo;s the plan:&lt;/p>
&lt;ol>
&lt;li>I want to publish multiple open source projects.&lt;/li>
&lt;li>I want to actively work on 1 bigger and already established open source
project&lt;/li>
&lt;li>I want to register aaron-torres.com, use it to build a personal portfolio
complete with blog, code, resume, etc.&lt;/li>
&lt;li>I want to write 2 blog posts a week&lt;/li>
&lt;li>I want to publish 3 Android applications (which includes learning Android)&lt;/li>
&lt;li>I want to work on a web application for my own personal business&lt;/li>
&lt;/ol>
&lt;p>This is a LOT to do in a short amount of time, however, I&amp;rsquo;m already off to a running start.&lt;/p>
&lt;h3 id="whats-been-done">What&amp;rsquo;s been done.&lt;/h3>
&lt;p>I&amp;rsquo;ve hit the ground running, lets get to it:&lt;/p>
&lt;ol>
&lt;li>Registered aaron-torres.com (hopefully you&amp;rsquo;re reading it right now). Started
redoing my resume and will have everything up soon&lt;/li>
&lt;li>Published gocolorize, an ANSI color library
&lt;a href="https://github.com/agtorre/gocolorize">https://github.com/agtorre/gocolorize&lt;/a>&lt;/li>
&lt;li>Started contributing to the Revel Go framework
(&lt;a href="http://robfig.github.io/revel/">http://robfig.github.io/revel/&lt;/a>)&lt;/li>
&lt;/ol>
&lt;h3 id="if-youd-like-to-read-more">If You&amp;rsquo;d Like to Read More.&lt;/h3>
&lt;p>Drop me a line! Star my projects on Github. I hope that I can slowly make myself into a content provider where the things I share are interesting and helpful. I appreciate you take the time to read this far, and I hope that I hold your interest.&lt;/p></description></item></channel></rss>